<html>
<head>
    <style>
        .answer {
            min-height: 50px
        }
    </style>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.1/css/materialize.min.css">
</head>
<body>

<div class="container">

    <h1>Yelp</h1>

    <section id="q1" class="question">
        <h4>How many businesses are in the city of Pittsburgh?</h4>
        <div class="answer"></div>
    </section>

    <section id="q2" class="question">
        <h4>What is the distance (km) between Denver and Boulder?</h4>
        <div class="answer"></div>
    </section>

    <section id="q3" class="question">
        <h4>What is the distance (km) between the two McDonald's in the city of Gilbert?</h4>
        <div class="answer"></div>
    </section>

    <section id="q4" class="question">
        <h4>What is the geographical center of all the McDonald's in the city of Phoenix?</h4>
        <div class="answer"></div>
    </section>

    <section id="q5" class="question">
        <h4>In Phoenix, are there more McDonald's or Starbucks?</h4>
        <div class="answer"></div>
    </section>

    <section id="q6" class="question">
        <h4>In Phoenix, which Starbucks has the most number of reviews?</h4>
        <div class="answer"></div>
    </section>

    <section id="q7" class="question">
        <h4>In Phoenix, which McDonald's is closest to this most-reviewed Starbucks?</h4>
        <div class="answer"></div>
    </section>

    <section id="q8" class="question">
        <h4>In Phoenix, how many coffee shops are within 2km of this most-reviewed Starbucks?</h4>
        <div class="answer"></div>
    </section>

    <section id="q9" class="question">
        <h4>In Phoenix, which McDonald's is the furthest north, and which is the furthest south?</h4>
        <div class="answer"></div>
    </section>

    <section id="q10" class="question">
        <h4>In Phoenix, which McDonald's has no Starbucks located within 5 kms?</h4>
        <div class="answer"></div>
    </section>
</div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/3.10.1/lodash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0-alpha1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.1/js/materialize.min.js"></script>    
    <script src="/js/geolib.js"></script>
    <script>

var items   // global scope (i.e., can be accessed in javascript console)

function solution1(){
    return _.filter(items,{'city':'Pittsburgh'}).length
}

function solution2(){
    // TODO: use the Internet to lookup the GPS coordinates
    var c0 = {latitude: 39.739236, longitude: -104.990251
}   // Denver
    var c1 = {latitude: 40.014986, longitude: -105.270546
}   // Boulder
    return geolib.getDistance(c0,c1)/1000 + ' km'
}

function solution3(){
    var businessesInGilbert = _.filter(items, {city: 'Gilbert'})

    var mcdonaldsInGilbert = _.filter(businessesInGilbert, {name: "McDonald's"})
    var mickeyD1 = {latitude:mcdonaldsInGilbert[0].latitude, longitude:mcdonaldsInGilbert[0].longitude}
    var mickeyD2 = {latitude:mcdonaldsInGilbert[1].latitude, longitude:mcdonaldsInGilbert[1].longitude}
   // console.log("mickeyD1: ", mickeyD1)
    //console.log('businessesInGilbert: ',mcdonaldsInGilbert)

    return geolib.getDistance(mickeyD1, mickeyD2)/1000+ ' km'
}

function solution4(){
    var businessesInPheonix = _.filter(items, {city: 'Phoenix'})
    var mcdonaldsInPheonix = _.filter(businessesInPheonix, {name: "McDonald's"})
    return 'TODO'
}

function solution5(){
    var businessesInPheonix = _.filter(items, {city: 'Phoenix'})
    var mcdonaldsInPheonix = _.filter(businessesInPheonix, {name: "McDonald's"})
    //console.log("mcdonaldsInPheonix.length", mcdonaldsInPheonix.length)
    var starbucksInPheonix = _.filter(businessesInPheonix, {name: "Starbucks"})
    //console.log("starbucksInPheonix: ", starbucksInPheonix.length)
    if(starbucksInPheonix.length > mcdonaldsInPheonix.length){
        return 'Starbucks'
    }
    else{
        return 'McDonalds'
    }
}

function solution6(){
    var businessesInPheonix = _.filter(items, {city: 'Phoenix'})
    var starbucksInPheonix = _.filter(businessesInPheonix, {name: "Starbucks"})
    //console.log("starbucksInPheonix", starbucksInPheonix)
    var maxReviews = _.max(starbucksInPheonix, function(d){
        return d.review_count
    })
    //console.log("maxReviews", maxReviews)
    return maxReviews.full_address
}

function solution7(){
    var businessesInPheonix = _.filter(items, {city: 'Phoenix'})
    var starbucksInPheonix = _.filter(businessesInPheonix, {name: "Starbucks"})
    //console.log("starbucksInPheonix", starbucksInPheonix)
    var maxReviews = _.max(starbucksInPheonix, function(d){
        return d.review_count
    })
    var maxReviewsCoords = {latitude: maxReviews.latitude, longitude: maxReviews.longitude}
    var mcdonaldsInPheonix = _.filter(businessesInPheonix, {name: "McDonald's"})

   // console.log("mcdonaldsInPheonix", mcdonaldsInPheonix)
    var mcdonaldsCoords = _.pick(mcdonaldsInPheonix, function(d){
            var lat = d.latitude
            var longitude = d.longitude
            return lat, longitude
    })
    //console.log('mcdonaldsCoords', mcdonaldsCoords)
   // console.log("geolib.findNearest(maxReviewsCoords, mcdonaldsCoords, 1)", geolib.findNearest(maxReviewsCoords, mcdonaldsCoords, 1))
    var nearest = geolib.findNearest(maxReviewsCoords, mcdonaldsCoords, 1)
    console.log('nearest', nearest)

    var finaladdress = _.find(mcdonaldsCoords, {latitude:nearest.latitude, longitude: nearest.longitude}, 'full_address')
    console.log('finaladdress', finaladdress)
    return finaladdress.full_address
}

function solution8(){
    var businessesInPheonix = _.filter(items, {city: 'Phoenix'})
    var starbucksInPheonix = _.filter(businessesInPheonix, {name: "Starbucks"})
    //console.log("starbucksInPheonix", starbucksInPheonix)
    var maxReviews = _.max(starbucksInPheonix, function(d){
        return d.review_count
    })
    var maxReviewsCoords = {latitude: maxReviews.latitude, longitude: maxReviews.longitude}
    var mcdonaldsInPheonix = _.filter(businessesInPheonix, {name: "McDonald's"})

   // console.log("mcdonaldsInPheonix", mcdonaldsInPheonix)
    var mcdonaldsCoords = _.pick(mcdonaldsInPheonix, function(d){
            var lat = d.latitude
            var longitude = d.longitude
            return lat, longitude
    })
    //console.log('mcdonaldsCoords', mcdonaldsCoords)
   // console.log("geolib.findNearest(maxReviewsCoords, mcdonaldsCoords, 1)", geolib.findNearest(maxReviewsCoords, mcdonaldsCoords, 1))
    var nearest = geolib.findNearest(maxReviewsCoords, mcdonaldsCoords, 1)
    console.log('nearest', nearest)

    var finaladdress = _.find(mcdonaldsCoords, {latitude:nearest.latitude, longitude: nearest.longitude}, 'full_address')
    console.log('nearest', nearest)
    var mickyLat = nearest.latitude
    console.log("nearest['latitude']", nearest['latitude'])
    var mickylong = nearest.longitude
    console.log('nearest.longitude', nearest.longitude)
    var coffeeShops = _.filter(businessesInPheonix, {'categories': ["Coffee & Tea"]})
    console.log('coffeeShops', coffeeShops)
    counter = 0
    _.forEach(coffeeShops, function(d){
        var lat = d.latitude
        console.log('lat', lat)
        var longitude1 = d.longitude
        console.log('longitude1', longitude1)
        if(geolib.isPointInCircle(
    {latitude: mickyLat, longitude: mickylong}, 
    {latitude: lat, longitude: longitude1}, 
    2000)){
            counter++
        }
    })
    return counter
}

function solution9(){
    var businessesInPheonix = _.filter(items, {city: 'Phoenix'})
    var mcdonaldsInPheonix = _.filter(businessesInPheonix, {name: "McDonald's"})

    var maxLatitude = _.max(mcdonaldsInPheonix, function(d){
            return d.latitude

    })
   // console.log('maxLatitude', maxLatitude)
    var minLatitude = _.min(mcdonaldsInPheonix, function(d){
        return d.latitude
    })
   // console.log('minLatitude', minLatitude)
    return 'Furthest McDonalds north is: ' +maxLatitude.full_address +', Furthest McDonalds south is: ' +minLatitude.full_address
}

function solution10(){
    var businessesInPheonix = _.filter(items, {city: 'Phoenix'})
    var starbucksInPheonix = _.filter(businessesInPheonix, {name: "Starbucks"})
    var mcdonaldsInPheonix = _.filter(businessesInPheonix, {name: "McDonald's"})
    var addresses = ''
    _.forEach(mcdonaldsInPheonix, function(mickeyD){
        _.forEach(starbucksInPheonix, function(starbucks){
            if(!geolib.isPointInCircle(
    {latitude: mickeyD.latitude, longitude: mickeyD.longitude}, 
    {latitude: starbucks.latitude, longitude: starbucks.longitude}, 
    5000)){
                console.log(mickeyD)
                return addresses += mickeyD.full_address+'\n'
            }
        })
    })
    console.log('addresses', addresses)
    return addresses
}

function run(id, solutionFunc, data){
    console.log('run solution for ' + id)
    var answer = solutionFunc(data)
    $(id).find('.answer').html(answer)
}

function loadDataThenRunSolutions(){
    $.get({url: 'http://bigdatahci2015.github.io/data/yelp/yelp_academic_dataset_business.5000.json.lines.txt'})
     .done(function(data){
         var lines = data.trim().split('\n')

         // convert text lines to json arrays and save them in `items`
         items = _.map(lines, JSON.parse)

         console.log('number of items loaded:', items.length)
         console.log('first item', items[0])

         run('#q1', solution1, items)
         run('#q2', solution2, items)
         run('#q3', solution3, items)
         run('#q4', solution4, items)
         run('#q5', solution5, items)
         run('#q6', solution6, items)
         run('#q7', solution7, items)
         run('#q8', solution8, items)
         run('#q9', solution9, items)
         run('#q10', solution10, items)
     })
     .fail(function(err){
         console.error(err)
     })
}

loadDataThenRunSolutions()

    </script>

</body>
</html>
